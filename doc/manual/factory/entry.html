<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
  <title>Glidein Entry Point Creation</title>


</head>


<body>

<h1>Glidein Entry Point Creation</h1>

<h2>Description</h2>

The Glidein Entry Point creation is handled by a command line tool. The
use of this tool is described here. \<br>

<h2>Index</h2>

<ul>

  <li><a href="#name">Command name</a></li>

  <li><a href="#args_raw">Command line arguments at
a glance</a></li>

  <li><a href="#args">A guide to arguments</a></li>

  <li><a href="#advanced">Advanced topics</a></li>

  <ul>

    <li><a href="#glexec">Integration with gLExec</a></li>
    <li><a href="#gcb">Integration with GCB</a></li>

    <li><a href="#security">Security handles</a></li>

  </ul>

  <li><a href="#ref">Reference</a></li>

</ul>

<h2><a name="name"></a>Command name</h2>

The installation is performed using the command<br>

<div style="margin-left: 40px;"><span style="font-family: monospace;">create_glidein</span><br>

</div>

<br>

located in<br>

<div style="margin-left: 40px;"><span style="font-family: monospace;">glideinWMS/creation</span><br>

</div>

<br>

It will create all the needed directories and files needed by a <a href="index.html#glidein_daemons">Glidein Factory Daemon</a>.<br>

<h2><a name="args_raw"></a>Command line
arguments at a glance</h2>

The command has the following options:<br>

&nbsp;
<table style="width: 100%;" border="1" cellpadding="2" cellspacing="2">

  <tbody>

    <tr>

      <th>Switch</th>

      <th></th>

      <th>Description</th>

      <th>Default</th>

    </tr>

    <tr>

      <td>-F&nbsp;|&nbsp;-factory </td>

      <td>&lt;ID&gt; </td>

      <td>Factory name</td>

      <td>`uname -n`</td>

    </tr>

    <tr>

      <td>-n&nbsp;|&nbsp;-name </td>

      <td>&lt;ID&gt; </td>

      <td>Glidein name</td>

      <td>-&nbsp;<b>Required</b></td>

    </tr>

    <tr>

      <td>-g&nbsp;|&nbsp;-gatekeeper </td>

      <td>&lt;gatekeeper&gt; </td>

      <td>Grid gatekeeper/resource</td>

      <td>-&nbsp;<b>Required</b></td>

    </tr>

    <tr>

      <td>-u&nbsp;|&nbsp;-gridtype </td>

      <td>&lt;grid_type&gt; </td>

      <td>Condor Grid type</td>

      <td>"gt2"</td>

    </tr>

    <tr>

      <td>-r&nbsp;|&nbsp;-rsl </td>

      <td>&lt;RSL&gt; </td>

      <td>Globus RSL option</td>

      <td><i>None</i> - Do not set</td>

    </tr>

    <tr>

      <td>-s&nbsp;|&nbsp;-startdir </td>

      <td>&lt;path|ID&gt; </td>

      <td>Where to start the glidein, usually "OSG","Condor" or
"."</td>

      <td>"."</td>

    </tr>

    <tr>

      <td>-S&nbsp;|&nbsp;-submitbase </td>

      <td>&lt;base_dir&gt; </td>

      <td>Submit base dir</td>

      <td>$HOME</td>

    </tr>

    <tr>

      <td>-W&nbsp;|&nbsp;-stagebase </td>

      <td>&lt;base_dir&gt; </td>

      <td>Stage base dir</td>

      <td>"/var/www/html/glidestage"</td>

    </tr>

    <tr>

      <td>-L&nbsp;|&nbsp;-stagesymlink </td>

      <td>&lt;Bool&gt; </td>

      <td>Can I symlink stage dir?
      <p>There need to be two copies, one in submit and one in
stage dir.<br>

Symlinking helps maintain consistency, but does require
both to be
visible at all times.</p>

      </td>

      <td>1</td>

    </tr>

    <tr>

      <td>-C&nbsp;|&nbsp;-condorbase </td>

      <td>&lt;base_dir&gt; </td>

      <td>Condor distribution base dir</td>

      <td>From environment</td>

    </tr>

    <tr>

      <td>-w&nbsp;|&nbsp;-webdir </td>

      <td>&lt;base_url&gt; </td>

      <td>Base Web server URL</td>

      <td>"http://`uname -n`/glidestage"</td>

    </tr>

    <tr>

      <td>-p&nbsp;|&nbsp;-proxy </td>

      <td>&lt;proxy_url&gt; </td>

      <td>Squid cache to use</td>

      <td><i>None</i> - Do not use</td>

    </tr>

    <tr>

      <td>-d&nbsp;|&nbsp;-schedd </td>

      <td>&lt;ScheddName&gt; </td>

      <td>Which schedd to use</td>

      <td>"schedd_glideins@`uname -n`"</td>

    </tr>

    <tr>

      <td>-a&nbsp;|&nbsp;-attr </td>

      <td>&lt;name=val&gt; </td>

      <td>Glidein attribute.
      <p>List as many as needed. All will be used.</p>

      </td>

      <td>[] - No attributes</td>

    </tr>

    <tr>

      <td>-v | -var</td>

      <td>&lt;name=val&gt;</td>

      <td>Glidein variable.<br>

      <br>

List as many as needed. All will be used.</td>

      <td>[] - No variables</td>

    </tr>

    <tr>

      <td>-f&nbsp;|&nbsp;-file </td>

      <td>&lt;absname[:relname[:can_modify]]&gt; </td>

      <td>User file to ship to WN.
      <p>List as many as needed. All will be used.</p>

      </td>

      <td>[] - No attributes </td>

    </tr>

    <tr>

      <td>-c&nbsp;|&nbsp;-script </td>

      <td>&lt;absname[:relname]&gt; </td>

      <td>User script to execute on WN.
      <p>List as many as needed. All will be used.</p>

      </td>

      <td>[] - No attributes </td>

    </tr>

    <tr>

      <td>-y&nbsp;|&nbsp;-subsys </td>

      <td>&lt;absname:conf_sw:dir:out_conf[:relname]&gt; </td>

      <td>User subsytem to ship to WN.
      <p>List as many as needed. All will be used.</p>

      </td>

      <td>[] - No attributes </td>

    </tr>

    <tr>

      <td>-m&nbsp;|&nbsp;-param </td>

      <td>&lt;name=val&gt; </td>

      <td>User param.
      <p>List as many as needed. All will be used.</p>

      </td>

      <td>[] - No attributes </td>

    </tr>

    <tr>

      <td>-e | -cfg</td>

      <td>&lt;filename&gt;</td>

      <td>Load configuration file</td>

      <td><span style="font-style: italic;">None</span>
- Do not load any file</td>

    </tr>

  </tbody>
</table>

<br>

<h2><a name="args"></a>A guide to arguments</h2>

You definitely <span style="font-weight: bold;">need to
set</span> the following arguments:<br>

<ul>

  <li><span style="font-family: monospace; font-weight: bold;">-name</span><br>

The name of the entry point. It will be used to advertise the entry
point, will be define Condor glidein attribute <span style="font-family: monospace;">GLIDEIN_Name</span>,
and is used also to create the directory names.<br>

    <br>

Choose a short name that describes the Grid resource it represents and
append a version number (like <span style="font-family: monospace;">"fnalcms_1"</span>).
It is very likely you will update the entry as times go one, and as
stated in the <a href="index.html#management">Glidein
Factory management section</a>, it is much easier to create a new
entry point than modify an existing one.</li>

  <li><span style="font-weight: bold; font-family: monospace;">-gatekeeper</span><br>

The identifier of your Grid resource (like <span style="font-family: monospace;">"cmsitbsrv01.fnal.gov/jobmanager-condor"</span>).<br>

    <br>

    <span style="font-weight: bold; font-family: monospace;">-rsl</span>
may also be needed. Please check the Grid site documentation and/or ask
the Grid site administrator.<br>

    <br>

The current implementation has been tested with Globus v2 Gatekeepers
only, but if you want to test it with different Condor Grid types,
please use <span style="font-weight: bold; font-family: monospace;">-gridtype</span>
(<span style="font-family: monospace;">"gt2"</span>
is the default).</li>

  <li><span style="font-weight: bold; font-family: monospace;">-proxy</span><br>

If you have a Web cache you can use, you set it here (like <span style="font-family: monospace;">"cmsitbsquid002.fnal.gov:3128"</span>).<br>

    <br>

If you cannot use any Web cache server, you can skip this argument (the
default is not to use caching).</li>

</ul>

You <span style="font-weight: bold;">most probably want
to set</span> the following arguments, too:<br>

<ul>

  <li><span style="font-weight: bold; font-family: monospace;">-submitbase</span><br>

Where to create the entry point submit directory. The default is the
user home directory.</li>

  <li><span style="font-weight: bold; font-family: monospace;">-stagedir</span>
and <span style="font-weight: bold; font-family: monospace;">-webdir</span><br>

These two define where the Web server directories are located.<br>

The defaults are reasonable, but you may have different needs.</li>

  <li><span style="font-weight: bold; font-family: monospace;">-startdir</span><br>

This argument defines where the glidein should run.<br>

    <br>

Most OSG sites are known to crash if you use your starting directory to
run. For those sites, it is good practice to specify <span style="font-family: monospace;">"Condor"</span> if
they are running Condor as the underlying batch system, and <span style="font-family: monospace;">"OSG"</span> else.</li>

  <li><span style="font-weight: bold; font-family: monospace;">-factory</span><br>

Changing this value from the name of the machine allows you to move the
factory without disrupting the system.</li>

  <li><span style="font-weight: bold; font-family: monospace;">-var
    </span><span style="font-family: monospace;">GLIDEIN_Site=&lt;sitestr&gt;</span><br>

This arguments&nbsp;defines the Condor glidein attribute <span style="font-family: monospace;">GLIDEIN_Site</span>.<br>

    <br>

Logically defining a site is useful, so that you can change entry
points but the user jobs do still known where they are running. If not
specified, it
defaults to the entry point name. </li>

</ul>

Some other arguments you <span style="font-weight: bold;">might
want to set</span>, are:<br>

<ul>

  <li><span style="font-family: monospace; font-weight: bold;">-attr</span><br>

Attributes you want to publish.<br>

    <br>

These are used by the <a href="../frontend/index.html#match_expr">VO
frontend matchmaking</a>.<br>

    <br>

Example attributes are:<br>

    <pre>'GLIDEIN_Arch="INTEL"'<br>'CMS_SiteID=23'</pre>

  </li>

  <li><span style="font-weight: bold; font-family: monospace;">-schedd</span><br>

If you want to use multiple Condor schedds or you don't like the
default name, you definitely need to set this (to something like <span style="font-family: monospace;">"myschedd@mymachine.mydomain"</span>)</li>

</ul>

<br>

You will also most probably want to use:<br>

<ul>

  <li><span style="font-weight: bold; font-family: monospace;">-cfg</span><br>

This allows you to load a set of variables from a file. As your system
elvolves, most options will stay the same, so it makes sense to store
them in a file, and leave on the command line only the ones that do
change (like the entry point name).<br>

    <br>

Please notice that several configuration files can be loaded.</li>

</ul>

<br>

The other arguments are for experts only and will be documented in
future releases, once more experience is gained.<br>

<br>

So a real life example would be:<br>

<pre style="margin-left: 40px;">[me@mymachine ~] cd glideinWMS/creation<br>[me@mymachine creation] ./create_glidein -name cms_1 -var GLIDEIN_Site=fnal -gatekeeper cmsitbsrv01.fnal.gov/jobmanager-condor -proxy "cmsitbsquid002.fnal.gov:3128" \<br> -startdir Condor -factory fnalcms \<br> -stagedir /var/www/html/wmsglidestage -webdir http://cms-xen6.fnal.gov/wmsglidestage \<br> -attr 'GLIDEIN_Arch="INTEL"' -attr 'CMS_SiteID=23' -attr 'GCCVersion="4.0.1"'</pre>

Or even better:<br>

<pre style="margin-left: 40px;">[me@mymachine ~] cd glideinWMS/creation<br>[me@mymachine creation] cat ~/cmsitb.txt<br>-gatekeeper cmsitbsrv01.fnal.gov/jobmanager-condor<br>-proxy "cmsitbsquid002.fnal.gov:3128"<br>-startdir Condor <br>-factory fnalcms<br>-stagedir /var/www/html/wmsglidestage <br>-webdir http://cms-xen6.fnal.gov/wmsglidestage<br>-attr GLIDEIN_Arch="INTEL" <br>-attr CMS_SiteID=23 <br>-attr GCCVersion="4.0.1"<br>-var GLIDEIN_Site=fnal<br>[me@mymachine creation] ./create_glidein -name cms_1 -cfg ~/cmsitb.txt</pre>

<h2><a name="advanced"></a>Advanced topics</h2>

While the above is enough for setting up a personal glidein pool on the
local area network, you will need to do more fine tuning when deploying
a larger one. In this section, the various advanced aspects of glidein
pools will be presented.<br>

<h3><a name="glexec"></a>Integration with
gLExec</h3>

As you may have noticed, all of the glideins are submitted with the
same service proxy. While this has the advantage of simplifying the
architecture and improve both efficiency and VO control, it does have a
few problems:<br>

<ul>

  <li>All glidein scripts and Condor daemons, AND user jobs all
run
under the same Unix UID. So users can interfere with the glidein tasks,
possibly hacking the system.&nbsp;<br>

Plus, when several glideins start on the same node (on multi
processor/core machines), one user job can interfere with another user
job.</li>

  <li>The real user is never authenticated against the Grid site
autorization infrastructure. This makes it impossible for the sites to
enforce their policies, nor analyze the useage of their resources; they
see only glideins. This makes them very unfriendly toward the glideins.</li>

</ul>

To solve this problem, some Grid sites are deploying gLExec on the
worker nodes. gLExec is a service that, taken<br>

<ul>

  <li>the user proxy, and</li>

  <li>the desired command</li>

</ul>

contacts the local authorization and mapping system, switches to the
UID of the user (as oposed to the glidein UID), and executes the
provided command as that UID. <br>

<br>

By using gLExec, a Glidein Factory can get rid of both of the above
problems, and still keep all the advantages.<br>

<br>

To enable gLExec support in an entry point, you need to specify:<br>

<div style="margin-left: 40px;"><span style="font-family: monospace;">-script
web_base/glexec_setup.sh</span><br>

<span style="font-family: monospace;">-var
GLEXEC_BIN=&lt;path to glexec&gt;</span><br>

<span style="font-family: monospace;"></span></div>

For most current gLExec installation this comes down to:<br>

<div style="margin-left: 40px;"><span style="font-family: monospace;">-var
GLEXEC_BIN=/opt/glite/sbin/glexec</span><br>

</div>

<br>

P.S.: At the time of writing, Condor had a bug that would not properly
forward the user proxy, so you have to also turn the delegation off and
enable encryption:<br>

<div style="margin-left: 40px;"><span style="font-family: monospace;">-var
DELEGATE_JOB_GSI_CREDENTIALS=False<br>

-var SEC_DEFAULT_ENCRYPTION=REQUIRED</span><br>

</div>

<h3><a name="gcb"></a>Integration with GCB</h3>

Condor daemons need two way communication in order to work properly.
This clashes with the network policies of most Grid sites, that have
worker nodes in private networks or implement a restrictive firewall.
To solve this, Condor provides GCB.
<br>
The detailed description of GCB is beyond the scope of this manual and
you should refer to the Condor documentation avaialble at <a href="http://www.cs.wisc.edu/condor/manual/v6.8/3_8Networking.html#sec:GCB">http://www.cs.wisc.edu/condor/manual/v6.8/3_8Networking.html#sec:GCB</a>. Here you will find only the parameters needed to enable it in the glideins.<br>
<br>
To use a single GCB, you need to specify:<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">-script web_base/gcb_one_setup.sh</span><br style="font-family: monospace;">
<span style="font-family: monospace;">-var GCB_IP=&lt;IP&gt;</span><br>
</div>
and optinally the GCB port (defaults to <span style="font-family: monospace;">65432</span>):<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">-var GCB_PORT=&lt;port&gt;</span><br>
</div>
<br>
If you are more sofisticate, and want to use <a href="http://www.cs.wisc.edu/condor/manual/v6.8/3_8Networking.html#SECTION00483500000000000000">GCB routing tables</a>, too, add:<br>
<div style="margin-left: 40px;"><span style="font-family: monospace;">-file &lt;path to routing file&gt;:gcb_route.cfg</span><br style="font-family: monospace;">
<span style="font-family: monospace;">-var&nbsp;GCB_REMAP_ROUTE=gcb_route.cfg</span><br>
</div>
<br>
Please be aware that the above will configure the glideins only; you
still need to properly configure the Collector and the submit machines.
<h3><a name="security"></a>Security handles</h3>

As mentioned in the <a href="../index.html#pool_glidein">statup
page</a>,&nbsp;the glidein pool must be properly configured
to protect it from hackers and malicious users. The same page also
describes what needs to be done on the collector machine.<br>

The glidein itself can also be configured. The default configuration
works fine for most&nbsp; users, but you may need to change them.<br>

<br>

The values are set using the <span style="font-weight: bold; font-family: monospace;">-var</span>
option, and the default values are:<br>

<ul>

  <li><span style="font-family: monospace; font-weight: bold;">SEC_DEFAULT_ENCRYPTION</span>=<span style="font-family: monospace;">OPTIONAL</span></li>

  <li><span style="font-family: monospace; font-weight: bold;">SEC_DEFAULT_INTEGRITY</span>=<span style="font-family: monospace;">REQUIRED</span></li>

  <li><span style="font-family: monospace; font-weight: bold;">DELEGATE_JOB_GSI_CREDENTIALS</span>=<span style="font-family: monospace;">False</span></li>

</ul>

<br>

<br>

<a name="ref"></a>
<table style="text-align: left; width: 100%;" border="0" cellpadding="2" cellspacing="2">

  <tbody>

    <tr>

      <td style="width: 50%; text-align: left; vertical-align: top;">
      <h2>Repository</h2>

      <h3>CVSROOT</h3>

cvsuser@cdcvs.fnal.gov:/cvs/cd<br>

      <h2>Package(s)</h2>

glideinWMS/creation</td>

      <td style="width: 50%; text-align: left; vertical-align: top;">
      <h2>Author(s)</h2>

Since Aug. 14th - Igor Sfiligoi (Fermilab Computing Division)</td>

    </tr>

  </tbody>
</table>

<br>

<br>

<br>

</body>
</html>
