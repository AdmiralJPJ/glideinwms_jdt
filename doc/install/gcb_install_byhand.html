<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<head>

<style>
BODY, P, DIV, H1, H2, H3, H4, H5, H6, ADDRESS, OL, UL, TITLE, TD, OPTION, SELECT {
 font-family: Verdana;
 
}

BODY, P, DIV, ADDRESS, OL, UL, LI, TITLE, TD, OPTION, SELECT {  
  font-size: 10.0pt;
  margin-top:0pt;  
  margin-bottom:0pt;  
} 

BODY, P {
  margin-left:0pt; 
  margin-right:0pt;
}

BODY {
  line-height: ;
  background: white;
  margin: 6px;
  padding: 0px;
}

h6 { font-size: 10pt }
h5 { font-size: 11pt }
h4 { font-size: 12pt }
h3 { font-size: 13pt }
h2 { font-size: 14pt }
h1 { font-size: 16pt }

blockquote {padding: 10px; border: 1px #DDDDDD dashed }

a img {border: 0}

</style>




</head>


<body revision="dmqrsvn_29cb8sqg:65">

<h1>
  Installation of a GCB node
</h1>
<h2>
  1. Description
</h2>
This node will serve as a
<a href=http://www.cs.wisc.edu/condor/gcb/ title="GCB Home Page">Generic
Connection Brokering (GCB)</a> node. If you are working over firewalls or NATs,
you will need one or more of these.<br>
GCB is needed every time you have a firewall or a NAT;&nbsp; if this node dies,
all theglideins relying on it will die with it.<br>
<h2>
  2. Hardware requirements
</h2>
This machine needs <span style=FONT-WEIGHT:bold>a reasonably recent CPU</span>
and a small amount of <span style=FONT-WEIGHT:bold>memory</span>
(<span style=FONT-WEIGHT:bold>256MB</span> should be enough).<br>
It must have <span style=FONT-WEIGHT:bold>reliable network</span> connectivity
and must be <span style=FONT-WEIGHT:bold>on the public internet,</span> with
<span style=FONT-WEIGHT:bold>no firewalls</span>; it will work as a router. It
will <span style=FONT-WEIGHT:bold>use 20k IP ports</span>, so it should not be
collocated with other network intesive applications.<br>
The machine must be <span style=FONT-WEIGHT:bold>very stable</span>; if the GCB
dies, all the glideins relying on it will die with it (You can use multiple GCBs
to minimize the damage, but you should still try to choose the stablest machine
you can afford.)<br>
The <span style=FONT-WEIGHT:bold>disk</span> needed is just for Condor binaries
and log files (<span style=FONT-WEIGHT:bold>5GB</span> should be enough)<br>
<br>
BTW: So low spec machine could be difficult to find and using a virtual machine
is out of question, due to the large amount of network ports used. Please
consider collocationg it with a
<a href="frontend_install.html" title="VO Frontend">VO Frontend</a>.<br>
<h2>
  3. Needed software
</h2>
A reasonably recent Linux OS (SL4 used at press time).<br>
The
<a href=http://www.cs.wisc.edu/condor/downloads/ title="Condor download page">Condor
distribution</a>.<br>
<h2>
  4. Installation instructions
</h2>
The installation will assume you install Condor v7.0.5 from tarballs as user
<span style=FONT-WEIGHT:bold>gcbuser</span>.<br>
The install directory will be
<span style=FONT-WEIGHT:bold>/home/gcbuser/condor/dist</span>, the working
directory is
<span style=FONT-WEIGHT:bold>/home/gcbuser/condor/condor_local</span> and the
machine name is <span style=FONT-WEIGHT:bold>mymachine.fnal.gov</span> and its
IP <span style=FONT-WEIGHT:bold>131.225.70.222</span><br>
If you want to use a different setup, make the necessary changes.<br>
<br>
P.S.: Please remmber to update the
<a href="schedd_install.html" title="scheduler configuration">scheduler
configuration</a> every time you add a new GCB node.<br>
<h3>
  4.1 Obtain Condor
</h3>
The Condor binaries can be downloaded from
<a href=http://www.cs.wisc.edu/condor/downloads/ title="Condor download page">http://www.cs.wisc.edu/condor/downloads/</a>.<br>
Choose the v7.0.5 link, read the license, insert your name and affiliation, and
proceed to the real download page.<br>
Download dynamic tarball for Red Hat Enterpise Linux 4 (you will get
condor-7.0.5-linux-x86-rhel3-dynamic.tar.gz) and put it in
<span style=FONT-WEIGHT:bold>/home/gcbuser/Downloads/</span>.<br>
<h3>
  4.2 Extract Condor binaries
</h3>
GCB cannot be installed using the standard Condor installation procedure; you
will need to install it by hand.<br>
<br>
Create the target directory:<br>
<div style=MARGIN-LEFT:40px>
  mkdir ~/condor<br>
  mkdir ~/condor/dist<br>
</div>
and untar the content of the tarball:<br>
<div style=MARGIN-LEFT:40px>
  cd ~/condor/dist<br>
  tar -xzf ~/Downloads/condor-7.0.5-linux-x86-rhel3-dynamic.tar.gz
  condor-7.0.5/release.tar<br>
  tar -xf condor-7.0.5/release.tar<br>
  rm -fr condor-7.0.5
</div>
<h3>
  4.3 Configure Condor
</h3>
GCB configuration is also a special thing... it is very loosly integrated in the
Condor infrastructure.<br>
For convenience, it is best to let a condor_master handle the GCB binaries, so
we will need to configure that, too.<br>
<br>
The config file
<span style=FONT-WEIGHT:bold>~/condor/dist/etc/condor_config</span> should be
something like this:<br>
<pre style=MARGIN-LEFT:40px>##  What machine is your central manager?<br>CONDOR_HOST             = mymachine.fnal.gov<br>COLLECTOR_HOST  = $(CONDOR_HOST)<br><br>##--------------------------------------------------------------------<br>##  Pathnames:<br>##--------------------------------------------------------------------<br>##  Where have you installed the bin, sbin and lib condor directories?<br>RELEASE_DIR             = /home/gcbuser/condor/dist<br><br>##  Where is the local condor directory for each host?<br>LOCAL_DIR               = /home/gcbuser/condor/condor_local<br><br>##  Where is the machine-specific local config file for each host?<br>LOCAL_CONFIG_FILE      = <br>LOCAL_ROOT_CONFIG_FILE  = $(RELEASE_DIR)/etc/condor_config.root<br><br>######################################################################<br>##  Daemon-wide settings:<br>######################################################################<br><br>##  Pathnames<br>LOG             = $(LOCAL_DIR)/log<br>SPOOL           = $(LOCAL_DIR)/spool<br>EXECUTE         = $(LOCAL_DIR)/execute<br>BIN             = $(RELEASE_DIR)/bin<br>LIB             = $(RELEASE_DIR)/lib<br>SBIN            = $(RELEASE_DIR)/sbin<br><br>##  Log files<br>MASTER_LOG      = $(LOG)/MasterLog<br>COLLECTOR_LOG   = $(LOG)/CollectorLog<br>GCB_BROKER_LOG  = $(LOG)/GCBLog<br><br>## Lock file<br>LOCK                    = $(LOCAL_DIR)/condor.lock<br><br>##  Where are the binaries for these daemons?<br>MASTER                          = $(SBIN)/condor_master<br>COLLECTOR                          = $(SBIN)/condor_collector<br><br><br>##--------------------------------------------------------------------<br>##  Mail parameters:<br>##--------------------------------------------------------------------<br>##  When something goes wrong with condor at your site, who should get<br>##  the email?<br>CONDOR_ADMIN            = me@fnal.gov<br><br>##  Full path to a mail delivery program that understands that "-s"<br>##  means you want to specify a subject:<br>MAIL                    = /bin/mailx<br><br>##--------------------------------------------------------------------<br>##  Host/IP access levels<br>##--------------------------------------------------------------------<br>HOSTALLOW_ADMINISTRATOR = $(CONDOR_HOST)<br>HOSTALLOW_OWNER = $(FULL_HOSTNAME), $(HOSTALLOW_ADMINISTRATOR)<br>HOSTALLOW_READ = *<br>HOSTALLOW_WRITE = *<br>CREATE_CORE_FILES       = True<br><br>##--------------------------------------------------------------------<br>##  Settings that control the daemon's debugging output:<br>##--------------------------------------------------------------------<br><br>##<br>## The flags given in ALL_DEBUG are shared between all daemons.<br>##<br>ALL_DEBUG               =<br><br>MAX_MASTER_LOG          = 640000<br>MASTER_DEBUG            = D_COMMAND<br><br>SEC_DEFAULT_AUTHENTICATION = REQUIRED<br>SEC_DEFAULT_AUTHENTICATION_METHODS = FS<br>SEC_DEFAULT_ENCRYPTION = OPTIONAL<br>SEC_DEFAULT_INTEGRITY = REQUIRED<br><br>SEC_READ_AUTHENTICATION = OPTIONAL<br>SEC_CLIENT_AUTHENTICATION = OPTIONAL<br>SEC_READ_ENCRYPTION = OPTIONAL<br>SEC_CLIENT_ENCRYPTION = OPTIONAL<br>SEC_READ_INTEGRITY = OPTIONAL<br>SEC_CLIENT_INTEGRITY = OPTIONAL<br><br>########################################################################<br><br>DAEMON_LIST = MASTER, COLLECTOR, GCB_BROKER<br><br>#####################################<br># Here starts GCB configuration<br>#####################################<br><br># Define the path to the broker binary for the master to spawn<br>GCB_BROKER = $(RELEASE_DIR)/libexec/gcb_broker<br><br># Define the path to the release_server binary for the broker to use<br>GCB_RELAY = $(RELEASE_DIR)/libexec/gcb_relay_server<br><br># Setup the gcb_broker's environment.  We use a macro to build up the<br># environment we want in pieces, and then finally define<br># GCB_BROKER_ENVIRONMENT, the setting that condor_master uses.<br><br># Initialize an empty macro<br>GCB_BROKER_ENV =<br><br># (recommended) Provide the full path to the gcb_relay_server<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_RELAY_SERVER=$(GCB_RELAY)<br><br># (recommended) Tell GCB to write all log files into the Condor log<br># directory (the directory used by the condor_master itself)<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_LOG_DIR=$(LOG)<br># Or, you can specify a log file seperately for each GCB daemon:<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_BROKER_LOG=$(LOG)/GCB_Broker_Log<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_RELAY_SERVER_LOG=$(LOG)/GCB_RS_Log<br><br># (optional -- only set if true) Tell the GCB broker that it can<br># directly connect to machines in the private network which it is<br># handling communication for.  This should only be enabled if the GCB<br># broker is running directly on a network boundry and can open direct<br># connections to the private nodes.<br>#GCB_BROKER_ENV = $(GCB_BROKER_ENV);ACTIVE_TO_CLIENT=yes<br><br># (optional) turn on verbose logging for all of GCB<br>#GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_DEBUG_LEVEL=fulldebug<br># Or, you can turn this on seperately for each GCB daemon:<br>#GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_BROKER_DEBUG=fulldebug<br>#GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_RELAY_SERVER_DEBUG=fulldebug<br><br># (optional) specify the maximum log file size (in bytes)<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_MAX_LOG=6400000<br># Or, you can define this seperately for each GCB daemon:<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_BROKER_MAX_LOG=64000000<br>#GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_RELAY_SERVER_MAX_LOG=640000<br><br># How many connections should it serve<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_MAX_RELAY_SERVERS=200<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_MAX_CLIENTS_PER_RELAY_SERVER=100<br><br># How tolerant should it be to blocked connections<br>GCB_BROKER_ENV = $(GCB_BROKER_ENV);GCB_COMMAND_TIMEOUT=1.5<br><br># Finally, set the value the condor_master really uses<br>GCB_BROKER_ENVIRONMENT = $(GCB_BROKER_ENV)<br><br># If your Condor installation on this host already has a public<br># interface as the default (either because it is the first interface<br># listed in this machine's host entry, or because you've already<br># defined NETWORK_INTERFACE), you can just use Condor's special macro<br># that holds the IP address for this.<br>GCB_BROKER_IP = $(ip_address)<br># Otherwise, you could define it yourself with your real public IP:<br>#GCB_BROKER_IP = 131.225.70.222<br><br># (required) define the command-line arguments for the broker<br>GCB_BROKER_ARGS = -i $(GCB_BROKER_IP)<br></pre>
<br>
The above config file can also be downloaded from
<a href=example-config/glide-gcb/mymachine/condor_config title=example-config/glide-gcb/mymachine/condor_config>example-config/glide-gcb/mymachine/condor_config</a>.<br>
<h3>
  4.4 Put Condor in the path
</h3>
Put the following lines in ~/.bashrc:<br>
<div style=MARGIN-LEFT:40px>
  if [ -z "$CONDOR_BASE_PATH" ]<br>
  then<br>
  &nbsp;export CONDOR_BASE_PATH=/home/gcbuser/condor/dist<br>
  &nbsp;export CONDOR_CONFIG=$CONDOR_BASE_PATH/etc/condor_config<br>
  <br>
  &nbsp;export PATH=$CONDOR_BASE_PATH/bin/:$PATH<br>
  &nbsp;export MANPATH=$CONDOR_BASE_PATH/man:$MANPATH<br>
  fi<br>
</div>
Reenter the shell to get the new setup.<br>
<h3>
  4.5 Initialize Condor directories
</h3>
Run <span style=FONT-WEIGHT:bold>condor_init</span>:<br>
<div style=MARGIN-LEFT:40px>
  ~/condor/dist/sbin/condor_init<br>
</div>
<h2>
  5. Start GCB
</h2>
Run <span style=FONT-WEIGHT:bold>condor_master</span>:<br>
<div style=MARGIN-LEFT:40px>
  ~/condor/dist/sbin/condor_master<br>
</div>
<h3>
  5.1 Verify it is running
</h3>
You can check that the processes are running:<br>
<div style=MARGIN-LEFT:40px>
  ps -u gcbuser |grep gcb<br>
</div>
You should see one gcb_broker and at least one gcb_relay_server.<br>
<br>
You can also check that tey are working well, by pinging it with
gcb_broker_query:<br>
<div style=MARGIN-LEFT:40px>
  ~/condor/dist/sbin/gcb_broker_query&nbsp; 131.225.70.222 freesockets<br>
</div>
<br>
<hr size=2 width=100%><a href="index.html" title="Back to the index">Back
to the index</a><br>
<br>
<br></body>
</html>
