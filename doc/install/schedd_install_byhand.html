<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<head>

<style>
BODY, P, DIV, H1, H2, H3, H4, H5, H6, ADDRESS, OL, UL, TITLE, TD, OPTION, SELECT {
 font-family: Verdana;
 
}

BODY, P, DIV, ADDRESS, OL, UL, LI, TITLE, TD, OPTION, SELECT {  
  font-size: 10.0pt;
  margin-top:0pt;  
  margin-bottom:0pt;  
} 

BODY, P {
  margin-left:0pt; 
  margin-right:0pt;
}

BODY {
  line-height: ;
  background: white;
  margin: 6px;
  padding: 0px;
}

h6 { font-size: 10pt }
h5 { font-size: 11pt }
h4 { font-size: 12pt }
h3 { font-size: 13pt }
h2 { font-size: 14pt }
h1 { font-size: 16pt }

blockquote {padding: 10px; border: 1px #DDDDDD dashed }

a img {border: 0}

</style>




</head>


<body revision="dmqrsvn_28dcr567:102">

<h1>
  Installation of a scheduler node in the glideinWMS
</h1>
<h2>
  1. Description
</h2>
This node will be a
<a href=http://www.cs.wisc.edu/condor/manual/v7.0/3_1Introduction.html#SECTION00411000000000000000 title="Condor manual">Condor
Submit node</a> for tbe user jobs.<br>
You can install many such nodes to improve scalability of your system.<br>
<h2>
  2. Hardware requirements
</h2>
This machine needs <span style=FONT-WEIGHT:bold>a reasonably recent
CPUs</span>&nbsp; and <span style=FONT-WEIGHT:bold>a large amount of
memory</span> (<span style=FONT-WEIGHT:bold>2+GB&nbsp;</span>&nbsp; recommended,
<span style=FONT-WEIGHT:bold>~1MB per running job</span>).<br>
The amount of <span style=FONT-WEIGHT:bold>disk</span> needed
<span style=FONT-WEIGHT:bold>depends on the user jobs</span>; Condor itself uses
very little (5 GB should be enough)<br>
<h2>
  3. Needed software
</h2>
Any
<a href=http://www.cs.wisc.edu/condor/manual/v7.0/1_5Availability.html title="Available architectures">Condor-supported
OS</a>.<br>
The
<a href=https://twiki.grid.iu.edu/twiki/bin/view/Documentation/WebHome title="OSG User Web page">OSG
client software</a>.<br>
The
<a href=http://www.cs.wisc.edu/condor/downloads/ title="Condor download page">Condor
distribution</a>.<br>
<h2>
  4. Installation instructions
</h2>
The installation will assume you install Condor v7.0.5 on a Linux machine, from
tarballs, as root.<br>
The install directory will be
<span style=FONT-WEIGHT:bold>/opt/glidecondor</span>, the working directory is
<span style=FONT-WEIGHT:bold>/opt/glidecondor/condor_local</span> and the
machine name is <span style=FONT-WEIGHT:bold>mymachine.fnal.gov</span> and the
glidein pool collector is located at
<span style=FONT-WEIGHT:bold>mypool.fnal.gov</span>. Moreover, the GCB nodes are
located at IP addresses <b>131.225.70.222</b> and <b>131.225.70.224</b>.<br>
If you want to use a different setup, make the necessary changes.<br>
<h3>
  4.1 Install Condor<br>
</h3>
Follow instructions in the
<a href="condor_v7.0.5_install.html" title="Condor v7.0.5 installation document">Condor
v7.0.5 installation document</a>.<br>
<h3>
  4.2 Make it part of the glidein pool<br>
</h3>
You will most probably want to install the scheduler on a separate node, so
disable collector, negotiator and start on this node, by adding the following
line to
<span style=FONT-WEIGHT:bold>/opt/glidecondor/condor_local/condor_config.local</span>:<br>
<div style=MARGIN-LEFT:40px>
  DAEMON_LIST&nbsp;&nbsp; = MASTER, SCHEDD<br>
</div>
<br>
and point the schedd to the glidein pool Collector, by adding the following line
to <span style=FONT-WEIGHT:bold>/opt/glidecondor/etc/condor_config</span>:<br>
<div style=MARGIN-LEFT:40px>
  CONDOR_HOST&nbsp;&nbsp;&nbsp; = mypool.fnal.gov<br>
</div>
<br>
<p>
  <br>
</p>
<p>
  PS: If instead you prefer to collate the schedulers with the glidein pool
  collector, follow
  <a href="collector_install.html" title="Installation of the glidein pool Collector">the
  collector node installation instructions</a>, and set in
  <span style=FONT-WEIGHT:bold>/opt/glidecondor/condor_local/condor_config.local</span>:<br>
</p>
<div style=MARGIN-LEFT:40px>
  DAEMON_LIST&nbsp;&nbsp; = MASTER, COLLECTOR, NEGOTIATOR, SCHEDD<br>
</div>
<p>
  <br>
</p>
<h3>
  4.3 Configure schedd settings
</h3>
The default values are unusable for large pools.<br>
<br>
Please add to
/<span style=FONT-WEIGHT:bold>opt/glidecondor/etc/condor_config</span> the
following lines:<br>
<div style=MARGIN-LEFT:40px>
  ###############################<br>
  # Schedd settings<br>
  ###############################<br>
  # Allow up to 2k concurrent running jobs<br>
  MAX_JOBS_RUNNING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 2000<br>
  # Start 8 jobs every 2 seconds<br>
  JOB_START_DELAY = 2<br>
  JOB_START_COUNT = 8<br>
  # Prevent checking on ImageSize<br>
  APPEND_REQ_VANILLA = (Memory&gt;=1)<br>
</div>
<h3>
  4.4 Configure Condor GSI security
</h3>
Follow instructions in the
<a href="gsi_config.html" title="Configuring GSI security in Condor">Configuring
GSI security in Condor</a> document.<br>
<br>
The <span style=FONT-WEIGHT:bold>/opt/glidecondor/certs/grid-mapfile</span> must
be populated with your own DN, the glidein pool service proxy DN and the DNs of
the glideins.<br>
Assuming the local service proxy DN is
"/DC=org/DC=doegrids/OU=Service/CN=schedd2" , the glidein pool COllector's DN in
"/DC=org/DC=doegrids/OU=Service/CN=collector5", and you have a single
glidein&nbsp; DN "/DC=org/DC=doegrids/OU=Service/CN=factory3",&nbsp; the
grid-mapfile would contain something like:<br>
<div style=MARGIN-LEFT:40px>
  "/DC=org/DC=doegrids/OU=Service/CN=schedd2" scondor<br>
  "/DC=org/DC=doegrids/OU=Service/CN=factory3" fcondor<br>
  "/DC=org/DC=doegrids/OU=Service/CN=fcollector5" ccondor<br>
</div>
The names you specify after the DN are not important, but they must differ one
from another.<br>
<br>
Please notice that the user's will be authenticated using their Unix UID. This
implies all submissions need to be local.<br>
If you prefer to force GSI authentication for user's, too (allowing for remote
submission), set<br>
<div style=MARGIN-LEFT:40px>
  SEC_DEFAULT_AUTHENTICATION_METHODS = GSI<br>
</div>
and insert all users' DNs in the
<span style=FONT-WEIGHT:bold>/opt/glidecondor/certs/grid-mapfile</span>. If you
start Condor as root, in this case the user names must correspond to actual UID
names.<br>
<h3>
  4.5 Configure Quill<br>
</h3>
Follow the instructions in the
<a href="quill_setup.html" title="Condor Quill setup">Condor Quill
setup</a> document.<br>
<h3>
  4.6 Setup GCB routing tables
</h3>
Create a file named <b>/opt/glidecondor/etc/gcb-routing-table</b> containing the
addresses of the GCBs:<br>
<blockquote>131.225.70.222/32 GCB<br>
131.225.70.224/32 GCB<br>
</blockquote>The add to
/<span style=FONT-WEIGHT:bold>opt/glidecondor/etc/condor_config</span> the
following lines:<br>
<blockquote>#####################################<br>
# Tell schedd daemons where is GCB<br>
#####################################<br>
SCHEDD.NET_REMAP_ENABLE=TRUE<br>
SCHEDD.NET_REMAP_SERVICE=GCB<br>
SCHEDD.NET_REMAP_ROUTE=/opt/glidecondor/etc/gcb-routing-table<br>
</blockquote><br>
<h3>
  4.7 Setup multiple schedds
</h3>
You will most probably need multiple schedd, if you want to scale.<br>
Configure the schedds <span style=FONT-WEIGHT:bold>schedd_jobs1,</span>
<span style=FONT-WEIGHT:bold>schedd_jobs2,</span>
<span style=FONT-WEIGHT:bold>schedd_jobs3</span> and
<span style=FONT-WEIGHT:bold>schedd_jobs4</span>,&nbsp; by following the
instructions in the
<a href="multi_schedd_config.html" title="Configuring multiple Schedds in Condor">Configuring
multiple Schedds in Condor</a> document.<br>
<h3>
  4.8 Example config files
</h3>
You can find the complete Condor config files in<br>
<a href=example-config/glide-schedd/mymachine/condor_config title=example-config/glide-schedd/mymachine/condor_config>example-config/glide-schedd/mymachine/condor_config</a><br>
and<br>
<a href=example-config/glide-schedd/mymachine/condor_config.local title=example-config/glide-schedd/mymachine/condor_config>example-config/glide-schedd/mymachine/condor_config.local</a>.<br>
<h2>
  5. Start Condor<br>
</h2>
If not already running, start PostgreSQL with:<br>
<div style=MARGIN-LEFT:40px>
  /etc/init.d/postgresql start<br>
</div>
<br>
In order to start all the schedulers, you now run several scripts. In order to
simplify your life, create <b>/opt/glidecondor/start_condor.sh</b>, contatining:<br>
<blockquote>#!/bin/bash<br>
/opt/glidecondor/sbin/condor_master<br>
sleep 1<br>
/opt/glidecondor/start_master_schedd.sh jobs1<br>
/opt/glidecondor/start_master_schedd.sh jobs2<br>
/opt/glidecondor/start_master_schedd.sh jobs3<br>
/opt/glidecondor/start_master_schedd.sh jobs4<br>
</blockquote> The same file can be downloaded from
<a href=example-config/glide-schedd/start_condor.sh title=example-config/glide-schedd/start_condor.sh>example-config/glide-schedd/start_condor.sh</a>.<br>
<br>
After you make it executable:<br>
<blockquote>chmod a+x /opt/glidecondor/start_condor.sh<br>
</blockquote>just run the new script:<br>
<div style=MARGIN-LEFT:40px>
  /opt/glidecondor/start_condor.sh
</div>
<br>
<h2>
  6. Submitting user jobs
</h2>
From the user point of view, this is just a regular Condor pool.<br>
<br>
However, since the resources potentially come from all over the world, users
need to create more complex <span style=FONT-WEIGHT:bold>Requirements</span>, in
order to prevent the jobs from landing on sites that cannot run their jobs.<br>
Users will need to know which attributes the glideins publish and use them
accordingly.<br>
<br>
One useful attribute that all Glideins publish is GLIDEIN_Site. If a user wants
to restrict its job to a list of sites, he can do it be using:<br>
<div style=MARGIN-LEFT:40px>
  +DESIRED_Sites = "Site1,Site4,Site7,Site22"<br>
  Requirements = stringListMember(GLIDEIN_Site,DESIRED_Sites)<br>
</div>
<br>
<hr size=2 width=100%><a href="index.html" title="Back to the index">Back
to the index</a><br></body>
</html>
